<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.20">
<title>Error Analysis and improvements</title>
<style>
@import '../web/kxygk.css';

html {
margin: 0;
overflow-x: hidden;
}
body {
margin-left: 0px;
margin-right: 0px;
margin-left: 5vw;
margin-right: 5vw;}
#table-of-contents {display: none} /* disable for now.. till I have a better plan */
.listingblock,pre.src {
margin-left:  0vw;
margin-right: 0vw;
font-family: monospace;
font-size: 100%;
background: #FFFFEE;
overflow: auto;
position: static;
border-top: 1px solid  #e5e5d6;
border-bottom: 1px solid  #e5e5d6;
}
pre.src-org {
color: red;
background: #FFFFFF;
}
blockquote {
width: 100%;
padding-left: 0.5em;
border-left: solid;
border-left-width: 4px;
border-left-color: grey;
background-color: #eefaf6; /*#f1ffee;*/
margin: 0;
.org-center {
text-align: center;}
}
svg { /* newer inline SVGs */
width: 100vw;
overflow: hidden;
height: auto;
margin-left: -5vw;
margin-right: 0;
}
/*.org-svg {
width: 100vw;
display: block;
margin-left: auto;
margin-right: auto;
}*/

img {
    display:flex;
max-width: 100%;
height: 100%;
max-height: 33vh;
vertical-align: middle;
width: auto;
margin: auto;
}
ul {
list-style-type: circle;
padding-left: 1.5em;
border-left: solid;
border-left-width: 1px;
border-left-color: grey;}
h1 {color: #596060;}
h2 {
    color: black;
font-style: italic;
    padding-top: 0.5em;
    border-bottom: 4px solid  #aaaaaa;}
h3 {color: black;
border-bottom: 2px dotted  #aaaaaa;}
b, i{
font-family: serif ;}
sup { /* fixes line spacing issues due to superscripts */
font-size: 0.8em;
line-height: 0;
position: relative;
vertical-align: baseline;
top: -0.5em;
}
sub { /* if these are missing then lines with subscripts take up more space */
font-size: 0.8em;
line-height: 0;
}
.title {
font-weight: bold;
}
dt {
font-weight: bold;
}
td p, dd p, li p{
    margin: 0;
}
ul, p{
    margin-top: 0;
}
.sidebarblock{
    background:#f3f3f2;
}
.float-group::before,.float-group::after{content:" ";display:table}
.left{float:left!important}
.right{float:right!important}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
.scrollbox{
    white-space: nowrap;
    overflow-x: scroll;
    scroll-snap-type: x mandatory;
}
.scrollbox img{
    height:auto;
    width:auto;
    max-width: 70vw;
    max-height: 60vh;
    vertical-align: bottom;
    scroll-snap-align: start;
}
video{
    height:auto;
    width:auto;
    max-width: 30vw;
    max-height: 30vh;
}
.content{
    height: 100%;
}
.imageblock{
    height: 100%;
}
.flexbox > .content{
    display: flex;
    justify-content: center;
    height: 33vh;
}

@media (max-width:60rem) {
.listingblock,pre.src {
    margin-left:  -5vw;
    margin-right: -5vw;
}}
@media (min-width:60rem) {
.sectionbody{
    column-count:2;
    hyphens: auto;
}
}
@media (min-width:90rem) {
.sectionbody{
    column-count:3;
}
}
@media (min-width:120rem) {
.sectionbody{
    column-count:4;
}
}

</style>
</head>
<body class="article">
<div id="header">
<h1>Error Analysis and improvements</h1>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Because many climate systems have positive/negative phases,
the climate patterns related to each phase can not undergo mixing.
To start observing the underlying patterns,
we select a region + time-span such that these pairs are the dominant climate systems.
We can then project "weather" on to their SV1/2 subspace.
SV1/2 will capture the majority of these two climate signals.
As a result,
the weather data will form two separate clusters in this subspace;
landing in to one or the other clump based on which phase is active.</p>
</div>
<div class="paragraph">
<p>This is the crux of the method</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../fig/imrg/errors/sv-projs-2d.svg" alt="sv projs 2d"></span></p>
</div>
<div class="paragraph">
<p>I am using 2 years of rain patterns,
split in to pentads,
with the leap day removed.
(not the full dataset because it&#8217;s going to get noisy!)</p>
</div>
<div class="paragraph">
<p>However,
this isn&#8217;t the end of it!
because the clump needs to be "extracted"</p>
</div>
<div class="paragraph">
<p>Each of the two clumps corresponds to a fixed mixture of SV1 and SV2.
The two climate mixing ratio are represented by two vectors in the SV1/2 space.
In theory,
each weather snapshot should live along one these two climate vectors.</p>
</div>
<div class="paragraph">
<p>If tertiary climate phenomena are weak,
then the vectors' associated SV1/2 ratio should give a robust approximations of the two original climate phase shapes.</p>
</div>
<div class="paragraph">
<p>To get the climate vectors:
 - I need to somehow divide the subspace such that I separate the two clumps
 - I then need to find the vector each clump is located on.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_initial_method">Initial method</h2>
<div class="sectionbody">
<div class="paragraph">
<p>What I have shown before:
 - I separate the point field in to two halves
 - I average the [x,y] coordinates of each half and find two central points
 - Each center point&#8217;s [x,y] coordinate forms a ratio;
 which corresponds to the SV1 SV2 ratio of its associated climate pattern.
 - I try every possible way to divide the point field.
 I then select the one that minimizes the total variance
 (using the deviations/distance between each point and their respective half&#8217;s center point)</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../fig/imrg/errors/sv-projs-2d-split.svg" alt="sv projs 2d split"></span></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_issues">Issues</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Assuming the pattern doesn&#8217;t change much based on the intensity of the climate pattern..
The climate phase that varies more in strength will come out having a high variance.
Hence,
the dividing line will bias to moving point to the low-variance pattern.</p>
</div>
<div class="paragraph">
<p>Furthermore,
the many low-signal days near the origin will move your centerpoint towards the origin.
This will make all deviations of high signal days higher</p>
</div>
<div class="paragraph">
<p>The distance to the origin is not directly relevant to what we are looking for.
The climate pattern is represented by a SV1 SV2 ratio,
so at face value,
the only relevant part is each point&#8217;s SV1 SV2 ratio.</p>
</div>
<div class="paragraph">
<p>Yet,
it feels like the points that lie near the origin should somehow count less,
because you have less climate going on and so it should give you less information.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_path_to_a_solution">Path to a Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The points near the origin are more sensitive to noise.
Noise causes deviations from the original climate vector,
which as a result causes larger changes in the SV1/SV2 ratio.</p>
</div>
<div class="paragraph">
<p>Because the SV1/SV2 ratio goes to infinity as S2 goes to zero,
this makes it an awkward formulation.
Instead I will work with angles.</p>
</div>
<div class="paragraph">
<p>These also have the advantage that they are easy to average.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_estimating_the_noise">Estimating the noise</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The pixel level noise is crudely estimated using the remaining SV3,4,5&#8230;&#8203; vectors.
Looking each point&#8217;s projection,
(inner product of a weather pattern and the SV1 and SV2 vectors)
we can then estimate how the pixel level errors propagate to the projection.</p>
</div>
<div class="paragraph">
<p>The inner product is a sum of products,
so the error can be estimated using a quadrature sum.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../fig/imrg/errors/sv-projs-nocorr.svg" alt="sv projs nocorr"></span></p>
</div>
<div class="paragraph">
<p>The resulting errors are tiny.
(you probably need to zoom in to see them)
They don&#8217;t explain the spread of we are seeing in each clump.
So there is some problem..</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_likely_issue">Likely Issue</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The likely root cause is the quadrature sum.
It assumes that the pixel level noise is uncorrelated.
However,
this is likely not true.
As a result,
this is causing a large underestimate in the deviation of the projection estimates.
In actuality the rain noise manifests as clumps and holes in the pattern.
The pixels in each clump/hole are highly correlated.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_solution">Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>I don&#8217;t have a method to estimate the level of correlation.
The correlation is neither spatially constant,
(the clumps/holes move around)
nor constant in time
(ie. the noise may be more clumpy during certain times of year)</p>
</div>
<div class="paragraph">
<p>Maybe I can estimate the correlation somehow in my noise snapshot,
but I don&#8217;t know how.
So estimating the noise now because impossible.
However,
I can instead estimate an upper bound on how bad the noise could get.
An effective upper limit to how much the noise can shift my projection.
I assume 100% correlation between all pixels;
in other words the scenario that all deviations goes in in the same direction at once.
This is equivalent to the whole climate pattern being covered by a hole or clump.
It is not physically sensible,
b/c it becomes indistinguishable from the climate signal.
But it provides a mathematical upper limit</p>
</div>
<div class="paragraph">
<p>The quadrature sum assumed the deviations may not be constructive.
Now we assume they are constructive,
and we carry out a simply sum all the deviations.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../fig/imrg/errors/sv-projs-corr.svg" alt="sv projs corr"></span></p>
</div>
<div class="paragraph">
<p>The result now gives a result that overestimates the variability (error bars = 1-sigma),
but is much closer to a useful value.
We can already envision a climate vector going through the error bars on each side.</p>
</div>
<div class="paragraph">
<p><strong>Note how the points lying further from the origin exhibit higher errors!</strong></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_angular_error">Angular Error</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Each point has an error in the SV1 projection,
as well as an error in SV2 projection.
The two errors form an error ellipse</p>
</div>
<div class="paragraph">
<p>The error ellipse has a radius orthogonal to the point vector.
(the line to the origin)
Based on this radius we can construct an upper bound on the angular error of each point</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../fig/imrg/errors/sv-projs-corr-ortho.svg" alt="sv projs corr ortho"></span></p>
</div>
<div class="paragraph">
<p>The angular errors are indicated in degrees with small numbers in each data point
(might require zooming in)
Mousing over the point will bring up a tooltip with the last field <code>:err-angle</code>,
also in degrees</p>
</div>
<div class="paragraph">
<p><strong>Note how the angular errors increase as you get closer to the origin</strong></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_climate_pattern_ratios">Climate pattern ratios</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We now have points and the upper limit of their noise-induced angular errors.
As before,
we again split the field and calculate averages.
However,
now we are doing a weighted average of each point&#8217;s angle,
weighted by the inverse square of its angular error.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../fig/imrg/errors/sv-projs-corr-ortho-split.svg" alt="sv projs corr ortho split"></span></p>
</div>
<div class="paragraph">
<p>Ref: <a href="https://seismo.berkeley.edu/~kirchner/Toolkits/Toolkit_12.pdf" class="bare">https://seismo.berkeley.edu/~kirchner/Toolkits/Toolkit_12.pdf</a>
(This is very useful resource:
has further information on calculating the error of the resulting mean.
It also explains how the error differs when you do a weighted average that&#8217;s not error-base. ex: amount weighted averaging)</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_climate_indices">Climate indices</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now that we have our climate basis vectors,
we finally have to evaluate each points magnitude along its respective axis.</p>
</div>
<div class="paragraph">
<p>Normally, when we have two non-orthogonal basis vectors,
we would expect to do a non-orthogonal projection to get new basis values.</p>
</div>
<div class="paragraph">
<p>However,
in our case we know that the two climate systems are non-cooccurring.
The off-climate-axis shift is not caused by the presence of the other climate basis,
but by noise in the original (higher dimensional) map.
To me here it seems more sensible to do an orthogonal projection.
ie. finding the nearest point on the basis vector
(this point maybe should be fleshed out more?
Maybe I should reproject the full weather map on to the climate basis vector?
Would that give me a different value?)</p>
</div>
<div class="paragraph">
<p>The error now is the radius of the error ellipse that is parallel to the respective basis vector</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../fig/imrg/errors/sv-projs-corr-proj-err.svg" alt="sv projs corr proj err"></span></p>
</div>
<div class="paragraph">
<p>Here the top climate pattern&#8217;s parallel error components are colored in green,
while the bottom equivalents are in blue</p>
</div>
<div class="paragraph">
<p>The orthogonal projections form the final climate index.
While the parallel ellipse radii form the error bars:</p>
</div>
<div class="paragraph">
<p>RESULT</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_performance_assessment">Performance assessment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To wrap things up,
we evaluate the new climate basis compared to the previous once</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">OLD vs NEW</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="image"><img src="../fig/imrg/errors/sv-projs-2d-split.svg" alt="sv projs 2d split"></span></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="image"><img src="../fig/imrg/errors/sv-projs-corr-split.svg" alt="sv projs corr split"></span></p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>With the full dataset it looks more like this
.OLD vs NEW</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="image"><img src="../fig/imrg/errors/old-sv-projs-full.svg" alt="old sv projs full"></span></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="image"><img src="../fig/imrg/errors/new-sv-projs-full.svg" alt="new sv projs full"></span></p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The basis vectors have a stronger separation.
The result look subjectively more correct.
They look more centered on the higher energy portion of each cluster,
less deflected by the near-origin points.
The winter/bottom axis in particular looks much better</p>
</div>
<div class="paragraph">
<p>Looking at the actual resulting climate patterns:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">OLD vs NEW</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="../fig/imrg/errors/old-top-pattern.svg" alt="old top pattern"></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="../fig/imrg/errors/new-top-pattern.svg" alt="new top pattern"></span></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">OLD vs NEW</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="image"><img src="../fig/imrg/errors/old-bottom-pattern.svg" alt="old bottom pattern"></span></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="image"><img src="../fig/imrg/errors/new-bottom-pattern.svg" alt="new bottom pattern"></span></p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For the full data-set the shift is a bit different</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">OLD vs NEW</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="../fig/imrg/errors/old-top-pattern-full.svg" alt="old top pattern full"></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="../fig/imrg/errors/new-top-pattern-full.svg" alt="new top pattern full"></span></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">OLD vs NEW</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="image"><img src="../fig/imrg/errors/old-bottom-pattern-full.svg" alt="old bottom pattern full"></span></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="image"><img src="../fig/imrg/errors/new-bottom-pattern-full.svg" alt="new bottom pattern full"></span></p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The new patterns also look a bit more correct,
with strongest East/West contrast.
Looking at regions over open water in regions opposite to moisture sources,
they exhibit less signal and form a stronger contrast to the primary rain-regions.</p>
</div>
<div class="paragraph">
<p>The final climate index:</p>
</div>
<div class="paragraph">
<div class="title">OLD vs NEW</div>
<p><span class="image"><img src="../fig/imrg/errors/old-indeces.svg" alt="old indeces"></span></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../fig/imrg/errors/new-indeces.svg" alt="new indeces"></span></p>
</div>
<div class="paragraph">
<p>The shifts here are nearly imperceptible,
however we now have a climate index with error bars.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../fig/imrg/errors/new-indeces-errors.svg" alt="new indeces errors"></span></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_limitations">Limitations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The method implicitly assumes normal symmetric errors.
This is problematic in a couple of related ways:
- The SV1/2 plane has all the points along a wedge.
Regions outside of the wedge result in mixtures with negative rain region.
While positive noise can "fill" the negative region,
it quickly become highly improbable.
- The rain noise no hard limit in the positive direction,
but it has a hard cut-off in the negative.
The noise can not be larger than the climate signal,
otherwise you would end up with a negative rain pixel.</p>
</div>
<div class="paragraph">
<p>We don&#8217;t actually establish errors on our values,
but an overestimated upper bound.
It&#8217;s a bit unclear how to use this in the final result.
I guess you could build a worst-case confidence interval,
but it&#8217;s with a lot of qualification</p>
</div>
<div class="paragraph">
<p>Looking at the original SV1/2 field with error ellipses,
it may make sense to look at ellipses that overlap with the dividing line.
They maybe should be labelled as "unknown" or potentially misclassified.
However,
removing them entirely would likely artificially skew the angular average outward.
That doesn&#8217;t seem ideal.
I&#8217;ve skipped this entirely b/c it feels like a rabbit hole..</p>
</div>
</div>
</div>
</div>
</body>
</html>